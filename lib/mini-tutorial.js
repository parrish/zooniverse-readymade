// Generated by CoffeeScript 1.9.1
(function() {
  var $, MiniTutorial,
    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };

  $ = window.jQuery;

  MiniTutorial = (function() {
    var steps;

    MiniTutorial.prototype.CLOSE_EVENT = 'mini-tutorial:close';

    steps = [];

    MiniTutorial.prototype.closeLabel = '&times;';

    MiniTutorial.prototype.previousLabel = 'Previous';

    MiniTutorial.prototype.nextLabel = 'Next';

    MiniTutorial.prototype.finishLabel = 'Finished';

    MiniTutorial.prototype.index = 0;

    MiniTutorial.prototype.template = function() {
      var i, step;
      return "<button type='button' name='readymade-mini-tutorial-close'>" + this.closeLabel + "</button> <div class='readymade-mini-tutorial-images'> " + (((function() {
        var j, len, ref, results;
        ref = this.steps;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          step = ref[j];
          results.push("<img src='" + step.image + "' class='readymade-mini-tutorial-image' />");
        }
        return results;
      }).call(this)).join('\n')) + " </div> <div class='readymade-mini-tutorial-contents'> " + (((function() {
        var j, len, ref, results;
        ref = this.steps;
        results = [];
        for (j = 0, len = ref.length; j < len; j++) {
          step = ref[j];
          results.push("<div class='readymade-mini-tutorial-content'>" + step.content + "</div>");
        }
        return results;
      }).call(this)).join('\n')) + " </div> <div class='readymade-mini-tutorial-actions'> <button type='button' name='readymade-mini-tutorial-previous'> <span class='readymade-mini-tutorial-button-label'>" + this.previousLabel + "</span> </button> <button type='button' name='readymade-mini-tutorial-next'> <span class='readymade-mini-tutorial-button-label'>" + this.nextLabel + "</span> </button> <button type='button' name='readymade-mini-tutorial-finish'> <span class='readymade-mini-tutorial-button-label'>" + this.finishLabel + "</span> </button> </div> <div class='readymade-mini-tutorial-steppers'> " + (((function() {
        var j, len, ref, results;
        ref = this.steps;
        results = [];
        for (i = j = 0, len = ref.length; j < len; i = ++j) {
          step = ref[i];
          results.push("<button type='button' name='readymade-mini-tutorial-stepper' value='" + i + "'> <span class='readymade-mini-tutorial-button-label'>" + (i + 1) + "</span> </button>");
        }
        return results;
      }).call(this)).join('\n')) + " </div>";
    };

    function MiniTutorial(options) {
      var key, value;
      for (key in options) {
        value = options[key];
        this[key] = value;
      }
      if (this.el == null) {
        this.el = document.createElement('div');
      }
      this.el.classList.add('readymade-mini-tutorial-underlay');
      this.close();
      if (this.dialog == null) {
        this.dialog = document.createElement('div');
      }
      this.dialog.classList.add('readymade-mini-tutorial-dialog');
      this.dialog.insertAdjacentHTML('afterBegin', this.template());
      this.images = this.dialog.querySelectorAll('.readymade-mini-tutorial-image');
      this.contents = this.dialog.querySelectorAll('.readymade-mini-tutorial-content');
      this.previousButton = this.dialog.querySelector('[name="readymade-mini-tutorial-previous"]');
      this.nextButton = this.dialog.querySelector('[name="readymade-mini-tutorial-next"]');
      this.finishButton = this.dialog.querySelector('[name="readymade-mini-tutorial-finish"]');
      this.steppers = this.dialog.querySelectorAll('[name="readymade-mini-tutorial-stepper"]');
      $(this.el).on('click', '[name="readymade-mini-tutorial-close"]', this.close.bind(this));
      $(this.el).on('click', '[name="readymade-mini-tutorial-previous"]', this.previous.bind(this));
      $(this.el).on('click', '[name="readymade-mini-tutorial-next"]', this.next.bind(this));
      $(this.el).on('click', '[name="readymade-mini-tutorial-finish"]', this.close.bind(this));
      $(this.el).on('click', '[name="readymade-mini-tutorial-stepper"]', (function(_this) {
        return function(e) {
          return _this.goTo(parseFloat(e.target.value));
        };
      })(this));
      this.el.appendChild(this.dialog);
      this.goTo(this.index);
    }

    MiniTutorial.prototype.goTo = function(index) {
      var element, elements, i, j, k, lastStep, len, len1, ref;
      this.index = index;
      this.index = modulo(this.index, this.steps.length);
      ref = [this.images, this.contents, this.steppers];
      for (j = 0, len = ref.length; j < len; j++) {
        elements = ref[j];
        for (i = k = 0, len1 = elements.length; k < len1; i = ++k) {
          element = elements[i];
          if (i === this.index) {
            element.setAttribute('data-readymade-active', true);
          } else {
            element.removeAttribute('data-readymade-active');
          }
        }
      }
      this.previousButton.disabled = this.index === 0;
      lastStep = this.steps.length - 1;
      this.nextButton.disabled = this.index === lastStep;
      this.finishButton.disabled = this.index !== lastStep;
    };

    MiniTutorial.prototype.previous = function() {
      this.goTo(this.index - 1);
    };

    MiniTutorial.prototype.next = function() {
      this.goTo(this.index + 1);
      return;
      return this.dialog.querySelector('button').focus();
    };

    MiniTutorial.prototype.open = function() {
      this.el.setAttribute('data-transitioning', true);
      setTimeout((function(_this) {
        return function() {
          _this.el.setAttribute('data-open', true);
          return _this.el.removeAttribute('data-transitioning');
        };
      })(this));
    };

    MiniTutorial.prototype.close = function() {
      this.el.setAttribute('data-transitioning', true);
      this.el.removeAttribute('data-open');
      setTimeout(this.el.removeAttribute.bind(this.el, 'data-transitioning'), 250);
      $(this.el).trigger(this.CLOSE_EVENT);
    };

    return MiniTutorial;

  })();

  module.exports = MiniTutorial;

}).call(this);
